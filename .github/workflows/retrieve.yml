on:
  workflow_dispatch:
  schedule:
    - cron: "0 3 * * *" # every morning at 3am UTC

name: Retrieve Data

jobs:
  # ------------------------------------------------------------------------------
  # Retrieve Eventbrite
  # ------------------------------------------------------------------------------
  retrieve_eventbrite:
    name: Retrieve Eventbrite
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: eventbrite.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 60
          max_attempts: 3
          command: npx clusterflick/scripts retrieve eventbrite.co.uk

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_eventbrite
          path: retrieved-data/

      - name: Save test failure artifacts
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_eventbrite-playwright-failures
          path: ./playwright-failures

  # ------------------------------------------------------------------------------
  # Retrieve TicketSource
  # ------------------------------------------------------------------------------
  retrieve_ticketsource:
    name: Retrieve TicketSource
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: ticketsource.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve ticketsource.co.uk

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_ticketsource
          path: retrieved-data/

      - name: Save test failure artifacts
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_ticketsource-playwright-failures
          path: ./playwright-failures

  # ------------------------------------------------------------------------------
  # Retrieve Sources
  # ------------------------------------------------------------------------------
  retrieve_sources:
    name: Retrieve Sources
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: outsavvy.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve outsavvy.com

      - name: designmynight.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve designmynight.com

      - name: dice.fm
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve dice.fm

      - name: tickettailor.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve tickettailor.com

      - name: wimbledonfilmclub.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve wimbledonfilmclub.co.uk

      - name: stowfilmlounge.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve stowfilmlounge.com

      - name: ti.to
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve ti.to

      - name: thecliq.app-
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thecliq.app-

      - name: bbk.ac.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve bbk.ac.uk

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_sources
          path: retrieved-data/

      - name: Save test failure artifacts
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_sources-playwright-failures
          path: ./playwright-failures

  # ------------------------------------------------------------------------------
  # Retrieve Source-Only Venues (Part 1)
  # ------------------------------------------------------------------------------
  retrieve_source_only_1:
    name: Retrieve Source-Only Venues (Part 1)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: allisjoysoho.com
        run: npx clusterflick/scripts retrieve allisjoysoho.com

      - name: bbk.ac.uk-central
        run: npx clusterflick/scripts retrieve bbk.ac.uk-central

      - name: bbk.ac.uk-cinema
        run: npx clusterflick/scripts retrieve bbk.ac.uk-cinema

      - name: beermerchantstap.com
        run: npx clusterflick/scripts retrieve beermerchantstap.com

      - name: freud.org.uk
        run: npx clusterflick/scripts retrieve freud.org.uk

      - name: pelicanhouse.org
        run: npx clusterflick/scripts retrieve pelicanhouse.org

      - name: artotel.com-battersea-power-station
        run: npx clusterflick/scripts retrieve artotel.com-battersea-power-station

      - name: artotel.com-hoxton
        run: npx clusterflick/scripts retrieve artotel.com-hoxton

      - name: claphamgrand.com
        run: npx clusterflick/scripts retrieve claphamgrand.com

      - name: rivoliballroom.com
        run: npx clusterflick/scripts retrieve rivoliballroom.com

      - name: beehiven17.com
        run: npx clusterflick/scripts retrieve beehiven17.com

      - name: boxpark.co.uk-wembley
        run: npx clusterflick/scripts retrieve boxpark.co.uk-wembley

      - name: frontlineclub.com
        run: npx clusterflick/scripts retrieve frontlineclub.com

      - name: ivyhousenunhead.com
        run: npx clusterflick/scripts retrieve ivyhousenunhead.com

      - name: rocketvan.co.uk
        run: npx clusterflick/scripts retrieve rocketvan.co.uk

      - name: theatreship.co.uk
        run: npx clusterflick/scripts retrieve theatreship.co.uk

      - name: uel.ac.uk-the-source
        run: npx clusterflick/scripts retrieve uel.ac.uk-the-source

      - name: bfi.org.uk-stephen-street
        run: npx clusterflick/scripts retrieve bfi.org.uk-stephen-street

      - name: goethe.de
        run: npx clusterflick/scripts retrieve goethe.de

      - name: marriott.com-w-london
        run: npx clusterflick/scripts retrieve marriott.com-w-london

      - name: mason-fifth.com-westbourne-park
        run: npx clusterflick/scripts retrieve mason-fifth.com-westbourne-park

      - name: ronspeckham.com
        run: npx clusterflick/scripts retrieve ronspeckham.com

      - name: theexhibit.co.uk
        run: npx clusterflick/scripts retrieve theexhibit.co.uk

      - name: imperial.ac.uk
        run: npx clusterflick/scripts retrieve imperial.ac.uk

      - name: culture.hu-london
        run: npx clusterflick/scripts retrieve culture.hu-london

      - name: kerbsocialclub.com
        run: npx clusterflick/scripts retrieve kerbsocialclub.com

      - name: londonwelsh.org
        run: npx clusterflick/scripts retrieve londonwelsh.org

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_source_only_1
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Source-Only Venues (Part 2)
  # ------------------------------------------------------------------------------
  retrieve_source_only_2:
    name: Retrieve Source-Only Venues (Part 2)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: castlehaven.org.uk
        run: npx clusterflick/scripts retrieve castlehaven.org.uk

      - name: japanhouselondon.uk
        run: npx clusterflick/scripts retrieve japanhouselondon.uk

      - name: william-the-fourth.com
        run: npx clusterflick/scripts retrieve william-the-fourth.com

      - name: exchangetwickenham.co.uk
        run: npx clusterflick/scripts retrieve exchangetwickenham.co.uk

      - name: langleyfilmbox.com
        run: npx clusterflick/scripts retrieve langleyfilmbox.com

      - name: scrt.onl
        run: npx clusterflick/scripts retrieve scrt.onl

      - name: sohoscreeningrooms.co.uk
        run: npx clusterflick/scripts retrieve sohoscreeningrooms.co.uk

      - name: thexchange.org.uk
        run: npx clusterflick/scripts retrieve thexchange.org.uk

      - name: uk.kef.com
        run: npx clusterflick/scripts retrieve uk.kef.com

      - name: goodshepherdstudios.com
        run: npx clusterflick/scripts retrieve goodshepherdstudios.com

      - name: thebathhouse.co
        run: npx clusterflick/scripts retrieve thebathhouse.co

      - name: siobhandavies.com
        run: npx clusterflick/scripts retrieve siobhandavies.com

      - name: thelondonarchives.org
        run: npx clusterflick/scripts retrieve thelondonarchives.org

      - name: boathousebarkingstudios.com
        run: npx clusterflick/scripts retrieve boathousebarkingstudios.com

      - name: feministlibrary.co.uk
        run: npx clusterflick/scripts retrieve feministlibrary.co.uk

      - name: goodhotel.co-london
        run: npx clusterflick/scripts retrieve goodhotel.co-london

      - name: aplaceforchange.co.uk
        run: npx clusterflick/scripts retrieve aplaceforchange.co.uk

      - name: mothclub.co.uk
        run: npx clusterflick/scripts retrieve mothclub.co.uk

      - name: qmul.ac.uk-bloc
        run: npx clusterflick/scripts retrieve qmul.ac.uk-bloc

      - name: islington.gov.uk-black-cultural-centre
        run: npx clusterflick/scripts retrieve islington.gov.uk-black-cultural-centre

      - name: thehenandchickenstheatrebar.co.uk
        run: npx clusterflick/scripts retrieve thehenandchickenstheatrebar.co.uk

      - name: london.czechcentres.cz
        run: npx clusterflick/scripts retrieve london.czechcentres.cz

      - name: peckhamlevels.org
        run: npx clusterflick/scripts retrieve peckhamlevels.org

      - name: rbkc.gov.uk-kensington-central-library
        run: npx clusterflick/scripts retrieve rbkc.gov.uk-kensington-central-library

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_source_only_2
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Source-Only Venues (Part 3)
  # ------------------------------------------------------------------------------
  retrieve_source_only_3:
    name: Retrieve Source-Only Venues (Part 3)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: thersa.org
        run: npx clusterflick/scripts retrieve thersa.org

      - name: ucl.ac.uk-ucl-east-community-cinema
        run: npx clusterflick/scripts retrieve ucl.ac.uk-ucl-east-community-cinema

      - name: courthouse-hotel.com-shoreditch
        run: npx clusterflick/scripts retrieve courthouse-hotel.com-shoreditch

      - name: courthouse-hotel.com-soho
        run: npx clusterflick/scripts retrieve courthouse-hotel.com-soho

      - name: facebook.com-thehaggerston
        run: npx clusterflick/scripts retrieve facebook.com-thehaggerston

      - name: signaturebrew.co.uk-blackhorseroad
        run: npx clusterflick/scripts retrieve signaturebrew.co.uk-blackhorseroad

      - name: walthamforest.gov.uk
        run: npx clusterflick/scripts retrieve walthamforest.gov.uk

      - name: bulgarihotels.com
        run: npx clusterflick/scripts retrieve bulgarihotels.com

      - name: cine-real.com
        run: npx clusterflick/scripts retrieve cine-real.com

      - name: piehousecoop.co.uk
        run: npx clusterflick/scripts retrieve piehousecoop.co.uk

      - name: professional.dolby.com-soho
        run: npx clusterflick/scripts retrieve professional.dolby.com-soho

      - name: themayfairhotel.co.uk
        run: npx clusterflick/scripts retrieve themayfairhotel.co.uk

      - name: chcc.org.uk
        run: npx clusterflick/scripts retrieve chcc.org.uk

      - name: crick.ac.uk
        run: npx clusterflick/scripts retrieve crick.ac.uk

      - name: fellowshipinn.co.uk
        run: npx clusterflick/scripts retrieve fellowshipinn.co.uk

      - name: gold.ac.uk
        run: npx clusterflick/scripts retrieve gold.ac.uk

      - name: islington.gov.uk-islington-museum
        run: npx clusterflick/scripts retrieve islington.gov.uk-islington-museum

      - name: kcl.ac.uk-strand
        run: npx clusterflick/scripts retrieve kcl.ac.uk-strand

      - name: khccc.com
        run: npx clusterflick/scripts retrieve khccc.com

      - name: thewildsbarkingriverside.london
        run: npx clusterflick/scripts retrieve thewildsbarkingriverside.london

      - name: rca.ac.uk-battersea
        run: npx clusterflick/scripts retrieve rca.ac.uk-battersea

      - name: rca.ac.uk-kensington
        run: npx clusterflick/scripts retrieve rca.ac.uk-kensington

      - name: thcentre.com
        run: npx clusterflick/scripts retrieve thcentre.com

      - name: uel.ac.uk-univeristy-square-stratford
        run: npx clusterflick/scripts retrieve uel.ac.uk-univeristy-square-stratford

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_source_only_3
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Source-Only Venues (Part 4)
  # ------------------------------------------------------------------------------
  retrieve_source_only_4:
    name: Retrieve Source-Only Venues (Part 4)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: metrolandcultures.com
        run: npx clusterflick/scripts retrieve metrolandcultures.com

      - name: myheathway.com
        run: npx clusterflick/scripts retrieve myheathway.com

      - name: newtownculture.org-womens-museum
        run: npx clusterflick/scripts retrieve newtownculture.org-womens-museum

      - name: princeofpeckham.co.uk
        run: npx clusterflick/scripts retrieve princeofpeckham.co.uk

      - name: reinstate.info
        run: npx clusterflick/scripts retrieve reinstate.info

      - name: scarlettmalone.com-subtitlecinema
        run: npx clusterflick/scripts retrieve scarlettmalone.com-subtitlecinema

      - name: shaispace.com
        run: npx clusterflick/scripts retrieve shaispace.com

      - name: strongroombar.com
        run: npx clusterflick/scripts retrieve strongroombar.com

      - name: thamesmeadnow.org.uk-the-nest
        run: npx clusterflick/scripts retrieve thamesmeadnow.org.uk-the-nest

      - name: thethomaswallcentre.harleystreethypnosis.co.uk
        run: npx clusterflick/scripts retrieve thethomaswallcentre.harleystreethypnosis.co.uk

      - name: ucl.ac.uk-bentham-house
        run: npx clusterflick/scripts retrieve ucl.ac.uk-bentham-house

      - name: ucl.ac.uk-ssees
        run: npx clusterflick/scripts retrieve ucl.ac.uk-ssees

      - name: better.org.uk-croydon-sports-arena
        run: npx clusterflick/scripts retrieve better.org.uk-croydon-sports-arena

      - name: dalstonsuperstore.com
        run: npx clusterflick/scripts retrieve dalstonsuperstore.com

      - name: ethicalproperty.co.uk-the-green-house
        run: npx clusterflick/scripts retrieve ethicalproperty.co.uk-the-green-house

      - name: stmarys.ac.uk-the-1850
        run: npx clusterflick/scripts retrieve stmarys.ac.uk-the-1850

      - name: thedivine.co.uk
        run: npx clusterflick/scripts retrieve thedivine.co.uk

      - name: triangledeptford.org
        run: npx clusterflick/scripts retrieve triangledeptford.org

      - name: lux.org.uk
        run: npx clusterflick/scripts retrieve lux.org.uk

      - name: setspace.uk
        run: npx clusterflick/scripts retrieve setspace.uk

      - name: thegreennunhead.org
        run: npx clusterflick/scripts retrieve thegreennunhead.org

      - name: vaginamuseum.co.uk
        run: npx clusterflick/scripts retrieve vaginamuseum.co.uk

      - name: wienerholocaustlibrary.org
        run: npx clusterflick/scripts retrieve wienerholocaustlibrary.org

      - name: objetstrouves.co.uk
        run: npx clusterflick/scripts retrieve objetstrouves.co.uk

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_source_only_4
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve BFI
  # ------------------------------------------------------------------------------
  retrieve_bfi:
    name: Retrieve BFI
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: bfi.org.uk-imax
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 30
          retry_wait_seconds: 30
          max_attempts: 10
          command: npx clusterflick/scripts retrieve bfi.org.uk-imax

      - name: bfi.org.uk-southbank
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 120
          retry_wait_seconds: 30
          max_attempts: 30
          command: npx clusterflick/scripts retrieve bfi.org.uk-southbank

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_bfi
          path: retrieved-data/

      - name: Save test failure artifacts
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_bfi-playwright-failures
          path: ./playwright-failures

  # ------------------------------------------------------------------------------
  # Retrieve Cineworld
  # ------------------------------------------------------------------------------
  retrieve_cineworld:
    name: Retrieve Cineworld
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: cineworld.co.uk-bexleyheath
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-bexleyheath

      - name: cineworld.co.uk-enfield
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-enfield

      - name: cineworld.co.uk-feltham
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-feltham

      - name: cineworld.co.uk-hounslow
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-hounslow

      - name: cineworld.co.uk-ilford
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-ilford

      - name: cineworld.co.uk-leicester-square
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-leicester-square

      - name: cineworld.co.uk-south-ruislip
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-south-ruislip

      - name: cineworld.co.uk-the-o2-greenwich
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-the-o2-greenwich

      - name: cineworld.co.uk-wandsworth
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-wandsworth

      - name: cineworld.co.uk-wembley
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-wembley

      - name: cineworld.co.uk-west-india-quay
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-west-india-quay

      - name: cineworld.co.uk-wood-green
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cineworld.co.uk-wood-green

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_cineworld
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Curzon
  # ------------------------------------------------------------------------------
  retrieve_curzon:
    name: Retrieve Curzon
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: curzon.com-aldgate
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-aldgate

      - name: curzon.com-bloomsbury
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-bloomsbury

      - name: curzon.com-camden
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-camden

      - name: curzon.com-hoxton
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-hoxton

      - name: curzon.com-kingston
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-kingston

      - name: curzon.com-mayfair
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-mayfair

      - name: curzon.com-richmond
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-richmond

      - name: curzon.com-soho
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-soho

      - name: curzon.com-victoria
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-victoria

      - name: curzon.com-wimbledon
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzon.com-wimbledon

      - name: curzonseacontainers.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve curzonseacontainers.com

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_curzon
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Electric Cinema
  # ------------------------------------------------------------------------------
  retrieve_electric_cinema:
    name: Retrieve Electric Cinema
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: electriccinema.co.uk-portobello
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve electriccinema.co.uk-portobello

      - name: electriccinema.co.uk-white-city
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve electriccinema.co.uk-white-city

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_electric_cinema
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Tate
  # ------------------------------------------------------------------------------
  retrieve_tate:
    name: Retrieve Tate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: tate.org.uk-tate-britain
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve tate.org.uk-tate-britain

      - name: tate.org.uk-tate-modern
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve tate.org.uk-tate-modern

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_tate
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Firmdale Hotels
  # ------------------------------------------------------------------------------
  retrieve_firmdale_hotels:
    name: Retrieve Firmdale Hotels
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: firmdalehotels.com-charlotte-street
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve firmdalehotels.com-charlotte-street

      - name: firmdalehotels.com-covent-garden
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve firmdalehotels.com-covent-garden

      - name: firmdalehotels.com-soho
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve firmdalehotels.com-soho

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_firmdale_hotels
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Olympic Studios
  # ------------------------------------------------------------------------------
  retrieve_olympic_studios:
    name: Retrieve Olympic Studios
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: olympiccinema.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve olympiccinema.com

      - name: thecinemaatselfridges.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thecinemaatselfridges.com

      - name: thecinemainthepowerstation.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thecinemainthepowerstation.com

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_olympic_studios
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Everyman
  # ------------------------------------------------------------------------------
  retrieve_everyman:
    name: Retrieve Everyman
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: everymancinema.com-baker-street
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-baker-street

      - name: everymancinema.com-barnet
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-barnet

      - name: everymancinema.com-belsize-park
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-belsize-park

      - name: everymancinema.com-borough-yards
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-borough-yards

      - name: everymancinema.com-brentford
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-brentford

      - name: everymancinema.com-broadgate
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-broadgate

      - name: everymancinema.com-canary-wharf
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-canary-wharf

      - name: everymancinema.com-chelsea
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-chelsea

      - name: everymancinema.com-crystal-palace
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-crystal-palace

      - name: everymancinema.com-hampstead
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-hampstead

      - name: everymancinema.com-kings-cross
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-kings-cross

      - name: everymancinema.com-maida-vale
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-maida-vale

      - name: everymancinema.com-muswell-hill
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-muswell-hill

      - name: everymancinema.com-screen-on-the-green
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-screen-on-the-green

      - name: everymancinema.com-stratford-international
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-stratford-international

      - name: everymancinema.com-the-whiteley
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve everymancinema.com-the-whiteley

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_everyman
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Vue (Part 1)
  # ------------------------------------------------------------------------------
  retrieve_vue_1:
    name: Retrieve Vue (Part 1)
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: myvue.com-bromley
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-bromley

      - name: myvue.com-croydon-grants
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-croydon-grants

      - name: myvue.com-croydon-purley-way
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-croydon-purley-way

      - name: myvue.com-dagenham
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-dagenham

      - name: myvue.com-eltham
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-eltham

      - name: myvue.com-finchley-road
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-finchley-road

      - name: myvue.com-fulham-broadway
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-fulham-broadway

      - name: myvue.com-harrow
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-harrow

      - name: myvue.com-islington
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-islington

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_vue_1
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Vue (Part 2)
  # ------------------------------------------------------------------------------
  retrieve_vue_2:
    name: Retrieve Vue (Part 2)
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: myvue.com-leicester-square
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-leicester-square

      - name: myvue.com-north-finchley
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-north-finchley

      - name: myvue.com-piccadilly
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-piccadilly

      - name: myvue.com-romford
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-romford

      - name: myvue.com-shepherds-bush
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-shepherds-bush

      - name: myvue.com-westfield
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-westfield

      - name: myvue.com-westfield-stratford-city
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-westfield-stratford-city

      - name: myvue.com-wood-green
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve myvue.com-wood-green

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_vue_2
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve ODEON
  # ------------------------------------------------------------------------------
  retrieve_odeon:
    name: Retrieve ODEON
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: odeon.co.uk-acton
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-acton

      - name: odeon.co.uk-beckenham
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-beckenham

      - name: odeon.co.uk-camden
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-camden

      - name: odeon.co.uk-greenwich
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-greenwich

      - name: odeon.co.uk-haymarket
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-haymarket

      - name: odeon.co.uk-holloway
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-holloway

      - name: odeon.co.uk-islington
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-islington

      - name: odeon.co.uk-kingston
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-kingston

      - name: odeon.co.uk-lee-valley
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-lee-valley

      - name: odeon.co.uk-leicester-square
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-leicester-square

      - name: odeon.co.uk-orpington
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-orpington

      - name: odeon.co.uk-putney
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-putney

      - name: odeon.co.uk-richmond
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-richmond

      - name: odeon.co.uk-south-woodford
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-south-woodford

      - name: odeon.co.uk-streatham
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-streatham

      - name: odeon.co.uk-swiss-cottage
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-swiss-cottage

      - name: odeon.co.uk-tottenham-court-road
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-tottenham-court-road

      - name: odeon.co.uk-uxbridge
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-uxbridge

      - name: odeon.co.uk-west-end
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-west-end

      - name: odeon.co.uk-wimbledon
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve odeon.co.uk-wimbledon

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_odeon
          path: retrieved-data/

      - name: Save test failure artifacts
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_odeon-playwright-failures
          path: ./playwright-failures

  # ------------------------------------------------------------------------------
  # Retrieve Picturehouses (Part 1)
  # ------------------------------------------------------------------------------
  retrieve_picturehouses_1:
    name: Retrieve Picturehouses (Part 1)
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: picturehouses.com-central
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-central

      - name: picturehouses.com-clapham
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-clapham

      - name: picturehouses.com-crouch-end
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-crouch-end

      - name: picturehouses.com-ealing
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-ealing

      - name: picturehouses.com-east-dulwich
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-east-dulwich

      - name: picturehouses.com-greenwich
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-greenwich

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_picturehouses_1
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Picturehouses (Part 2)
  # ------------------------------------------------------------------------------
  retrieve_picturehouses_2:
    name: Retrieve Picturehouses (Part 2)
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: picturehouses.com-finsbury-park
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-finsbury-park

      - name: picturehouses.com-hackney
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-hackney

      - name: picturehouses.com-the-gate
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-the-gate

      - name: picturehouses.com-the-ritzy
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-the-ritzy

      - name: picturehouses.com-west-norwood
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve picturehouses.com-west-norwood

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_picturehouses_2
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Indy Cinema Group
  # ------------------------------------------------------------------------------
  retrieve_indy_cinema_group:
    name: Retrieve Indy Cinema Group
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: regentstreetcinema.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve regentstreetcinema.com

      - name: phoenixcinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve phoenixcinema.co.uk

      - name: actonecinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve actonecinema.co.uk

      - name: chiswickcinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve chiswickcinema.co.uk

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_indy_cinema_group
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Savoy Systems
  # ------------------------------------------------------------------------------
  retrieve_savoy_systems:
    name: Retrieve Savoy Systems
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install

      - name: riocinema.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve riocinema.org.uk

      - name: thelexicinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thelexicinema.co.uk

      - name: thearzner.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thearzner.com

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_savoy_systems
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Remaining Cinemas (Part 1)
  # ------------------------------------------------------------------------------
  retrieve_remaining_cinemas_1:
    name: Retrieve Remaining Cinemas (Part 1)
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: lumiereromford.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve lumiereromford.com

      - name: metrocinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve metrocinema.co.uk

      - name: backyardcinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve backyardcinema.co.uk

      - name: eventimapollo.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve eventimapollo.com

      - name: lost.org
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve lost.org

      - name: thenickel.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thenickel.co.uk

      - name: barbican.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve barbican.org.uk

      - name: thegardencinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thegardencinema.co.uk

      - name: richmix.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve richmix.org.uk

      - name: closeupfilmcentre.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve closeupfilmcentre.com

      - name: cinemamuseum.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve cinemamuseum.org.uk

      - name: riversidestudios.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve riversidestudios.co.uk

      - name: sciencemuseum.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve sciencemuseum.org.uk

      - name: ica.art
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve ica.art

      - name: institut-francais.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve institut-francais.org.uk

      - name: irishculturalcentre.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve irishculturalcentre.co.uk

      - name: jw3.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve jw3.org.uk

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_remaining_cinemas_1
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Retrieve Remaining Cinemas (Part 2)
  # ------------------------------------------------------------------------------
  retrieve_remaining_cinemas_2:
    name: Retrieve Remaining Cinemas (Part 2)
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
      - name: Set Playwright path
        run: echo "PLAYWRIGHT_BROWSERS_PATH=$HOME/.cache/playwright-browsers" >> $GITHUB_ENV
      - uses: actions/setup-node@v4
        with:
          node-version-file: .node-version
      - run: npm install
      - run: npx playwright install --with-deps

      - name: princecharlescinema.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve princecharlescinema.com

      - name: genesiscinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve genesiscinema.co.uk

      - name: forestcinema.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve forestcinema.co.uk

      - name: arthousecrouchend.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve arthousecrouchend.co.uk

      - name: thecastlecinema.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thecastlecinema.com

      - name: castlesidcup.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve castlesidcup.com

      - name: davidleancinema.org.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve davidleancinema.org.uk

      - name: kilntheatre.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve kilntheatre.com

      - name: sandsfilms.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve sandsfilms.co.uk

      - name: coldharbourblue.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve coldharbourblue.com

      - name: peckhamplex.london
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve peckhamplex.london

      - name: royalalberthall.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve royalalberthall.com

      - name: omniplex.co.uk-sutton
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve omniplex.co.uk-sutton

      - name: fulhampier.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve fulhampier.com

      - name: acflondon.org
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve acflondon.org

      - name: thehorsehospital.com
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thehorsehospital.com

      - name: thehammondtheatre.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve thehammondtheatre.co.uk

      - name: lewisham.gov.uk-deptford-lounge
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve lewisham.gov.uk-deptford-lounge

      - name: dugdaleartscentre.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve dugdaleartscentre.co.uk

      - name: sydenhamarts.co.uk
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve sydenhamarts.co.uk

      - name: whitechapelgallery.org
        uses: nick-fields/retry@v3
        with:
          timeout_minutes: 20
          max_attempts: 3
          command: npx clusterflick/scripts retrieve whitechapelgallery.org

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: retrieve_remaining_cinemas_2
          path: retrieved-data/

  # ------------------------------------------------------------------------------
  # Create release using data from all jobs
  # ------------------------------------------------------------------------------
  create_release:
    name: Create Release
    runs-on: ubuntu-latest
    needs:
      [
        retrieve_eventbrite,
        retrieve_ticketsource,
        retrieve_sources,
        retrieve_source_only_1,
        retrieve_source_only_2,
        retrieve_source_only_3,
        retrieve_source_only_4,
        retrieve_bfi,
        retrieve_cineworld,
        retrieve_curzon,
        retrieve_electric_cinema,
        retrieve_tate,
        retrieve_firmdale_hotels,
        retrieve_olympic_studios,
        retrieve_everyman,
        retrieve_vue_1,
        retrieve_vue_2,
        retrieve_odeon,
        retrieve_picturehouses_1,
        retrieve_picturehouses_2,
        retrieve_indy_cinema_group,
        retrieve_savoy_systems,
        retrieve_remaining_cinemas_1,
        retrieve_remaining_cinemas_2,
      ]
    steps:
      - name: Download All Artifacts
        uses: actions/download-artifact@v4
        with:
          path: retrieved-data/
          merge-multiple: true
      - name: Generate Tag
        run: echo "TAG=$(TZ=Europe/London date +'%Y%m%d.%H%M%S')" >> $GITHUB_ENV
      - uses: ncipollo/release-action@v1
        id: release
        with:
          allowUpdates: false
          artifactErrorsFailBuild: true
          artifacts: "retrieved-data/*"
          makeLatest: true
          tag: ${{ env.TAG }}
          commit: main
          body: |
            Created by job ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
      - name: Output summary
        run: |
          echo " New release - ${{ steps.release.outputs.html_url }}" >> $GITHUB_STEP_SUMMARY

      - name: Repository Dispatch
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.PAT }}
          repository: clusterflick/data-transformed
          event-type: release_event
